<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ã“ã‚ŒãŒãƒ›ãƒ³ãƒˆã®ã¡ã‚‰ã—å¯¿å¸</title>
<style>
  body {
    background:
      repeating-linear-gradient(
        45deg,
        #fff8ee,
        #fff8ee 20px,
        #fff4e0 20px,
        #fff4e0 40px
      );
    font-family:sans-serif;
    text-align:center;
    margin:0;
  }

  h2 {
    font-size:14px;
    margin-top:20px;
    color:#666;
  }
  h1 {
    margin:5px 0 20px;
  }

  .container {
    display:flex;
    justify-content:center;
    gap:40px;
    padding:0 10px;
  }

  .board-wrapper {
    position:relative;
  }

  .label {
    margin-bottom:6px;
    font-size:14px;
    color:#555;
  }

  :root {
    --cell-size: 80px;
  }

  .board {
    display:grid;
    grid-template-columns:repeat(3, var(--cell-size));
    gap:6px;
    padding:12px;
    border-radius:12px;
  }

  .sample {
    background:#f3e3c3;
    border:6px solid #c9a063;
    box-shadow:inset 0 0 10px rgba(0,0,0,0.15);
  }

.play {
  background:#f9f9f9;              /* å°‘ã—ã ã‘è‰²å‘³ã‚’ã¤ã‘ã‚‹ */
  border:6px solid #ddd;            /* sampleã¨å¤ªã•ã‚’æƒãˆã‚‹ */
  box-shadow:inset 0 0 8px rgba(0,0,0,0.1);
}

  .cell {
    width:var(--cell-size);
    height:var(--cell-size);
    background:#fff;
    display:flex;
    align-items:center;
    justify-content:center;
    cursor:pointer;
    user-select:none;
    touch-action:manipulation;
  }

  .cell img {
    width:100%;
    height:100%;
    object-fit:contain;
    pointer-events:none;
  }

  .empty {
    background:#ddd;
    cursor:default;
  }

  .play .cell:hover:not(.empty) {
    transform:scale(1.05);
    transition:0.1s;
  }

  #clear {
    display:none;
    margin:36px 0;
  }

  #clear h1 {
    font-size:36px;
    animation:pop 0.6s ease-out;
  }

  @keyframes pop {
    0% { transform:scale(0.6); opacity:0; }
    80% { transform:scale(1.1); }
    100% { transform:scale(1); opacity:1; }
  }

  button {
    margin-top:18px;
    padding:14px 30px;
    font-size:18px;
    cursor:pointer;
  }

  @media (max-width: 700px) {
    .container {
      flex-direction:column;
      align-items:center;
      gap:24px;
    }

    :root {
      --cell-size: 64px;
    }

    #clear h1 {
      font-size:32px;
    }
  }
  
.cheer {
  position: fixed;
  right: 20px;
  bottom: 20px;
  background: #fff;
  border: 3px solid #333;
  border-radius: 12px;
  padding: 10px 14px;
  font-size: 14px;
  font-weight: bold;
  box-shadow: 2px 2px 0 #333;
  pointer-events: none;
  z-index: 999;

  display: none; /* â† è¶…é‡è¦ */
}

@keyframes cheerPop {
  0% {
    transform: scale(0.8);
    opacity: 0;
  }
  20% {
    transform: scale(1.05);
    opacity: 1;
  }
  100% {
    transform: scale(1);
    opacity: 1;   /* â† ã“ã“ãŒé‡è¦ */
  }
}


</style>
</head>
<body>

<h2>å¯¿å¸ã®ã‚¹ãƒ©ã‚¤ãƒ‰ãƒ‘ã‚ºãƒ«</h2>
<h1>ã“ã‚ŒãŒãƒ›ãƒ³ãƒˆã®ã¡ã‚‰ã—å¯¿å¸</h1>

<div class="container">
  <div class="board-wrapper">
    <div class="label">å®Œæˆè¦‹æœ¬ï¼ˆå¯¿å¸æ¡¶ï¼‰</div>
    <div id="left" class="board sample"></div>
  </div>

<div class="board-wrapper">
  <div class="label" id="guide">ç››ã‚Šä»˜ã‘ä¸­ï¼ˆå‹•ã‹ã—ã¦ã­ï¼‰</div>
  <div class="cheer" id="cheer"></div>
  <div id="right" class="board play"></div>
</div>

</div>

<div id="clear">
  <h1>å®Œæˆã§ã™ã—ï¼ğŸ‰</h1>
  <button onclick="init()">ã‚‚ã†ä¸€åº¦ç››ã‚Šä»˜ã‘ã‚‹</button>
</div>

<audio id="clearSE" src="pafupafu.mp3"></audio>
<audio id="bgm" src="BGM.mp3" loop></audio>

<script>
const cheerMessages = [
  "ãã†ããŸã‹ï¼",
  "ã„ã„ã¡ã‚‰ã—å…·åˆã ï¼",
  "å¿œæ´ã—ã¦ã‚‹ãï¼",
  "ãƒŠã‚¤ã‚¹å¯¿å¸ï¼"
];
const sushiImages = ["1.png","2.png","3.png","4.png","5.png"];
const size = 3;
const total = size * size;

let goal = [];
let board = [];
let cleared = false;
let moveCount = 0;

const clearSE = document.getElementById("clearSE");
clearSE.volume = 0.2;

const bgm = document.getElementById("bgm");
bgm.volume = 0.2;

/* â˜… ä¿®æ­£ãƒã‚¤ãƒ³ãƒˆâ‘ ï¼šslideSE ã‚’1å›ã ã‘ç”Ÿæˆ */
const slideSE = new Audio("slide.mp3");
slideSE.volume = 0.6;

/* iOSéŸ³å£°è§£ç¦ï¼ˆBGM + SEï¼‰ */
window.addEventListener("click", () => {
  if (bgm.paused) bgm.play();
 }, { once:true });

function playSlideSE() {
  slideSE.pause();          // â˜… ã“ã‚ŒãŒè¶…é‡è¦
  slideSE.currentTime = 0;
  slideSE.play().catch(() => {});
}


function shuffle(arr) {
  return arr.sort(() => Math.random() - 0.5);
}

function init() {
  cleared = false;
  document.getElementById("clear").style.display = "none";

  goal = [];
  for (let i = 0; i < total - 1; i++) {
    goal.push(sushiImages[Math.floor(Math.random()*sushiImages.length)]);
  }
  goal.push(null);
  goal = shuffle(goal);

  board = shuffle([...goal]);
  render();
}

function render() {
  const left = document.getElementById("left");
  const right = document.getElementById("right");
  left.innerHTML = "";
  right.innerHTML = "";

  goal.forEach(s => left.appendChild(createCell(s)));
  board.forEach((s,i) => {
    const cell = createCell(s);
    cell.onclick = () => move(i);
    right.appendChild(cell);
  });
}

function createCell(sushi) {
  const d = document.createElement("div");
  d.className = "cell" + (sushi === null ? " empty" : "");
  if (sushi) {
    const img = document.createElement("img");
    img.src = sushi;
    d.appendChild(img);
  }
  return d;
}

function canMoveTile(i, empty) {
  const row = Math.floor(i / size);
  const emptyRow = Math.floor(empty / size);

  if (row === emptyRow && Math.abs(i - empty) === 1) return true;
  if (Math.abs(i - empty) === size) return true;

  return false;
}

let cheerTimer = null;

function showCheer() {
  const cheer = document.getElementById("cheer");
  const msg = cheerMessages[Math.floor(Math.random() * cheerMessages.length)];

  // ã‚¿ã‚¤ãƒãƒ¼ãŒæ®‹ã£ã¦ãŸã‚‰æ¶ˆã™
  if (cheerTimer) {
    clearTimeout(cheerTimer);
    cheerTimer = null;
  }

  cheer.textContent = "ğŸ—¯ï¸ " + msg;
  cheer.style.display = "block";

  // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ¯å›ã‚»ãƒƒãƒˆ
  cheer.style.animation = "none";
  cheer.offsetHeight; // å†æç”»
  cheer.style.animation = "cheerPop 1s ease-out";

  cheerTimer = setTimeout(() => {
    cheer.style.display = "none";
    cheerTimer = null;
  }, 1500);
}


function move(i) {
  if (cleared) return;

  const empty = board.indexOf(null);
  if (!canMoveTile(i, empty)) return;

  playSlideSE();
  moveCount++;

  // â˜… å…ˆã«ç›¤é¢ã‚’å‹•ã‹ã™
  [board[i], board[empty]] = [board[empty], board[i]];

  // â˜… ã‚¯ãƒªã‚¢ã˜ã‚ƒãªã„ & 3å›ã«1å›ã ã‘å‡ºã™
  if (!isClear() && moveCount % 3 === 0) {
    showCheer();
  }

  render();

  if (isClear()) {
    cleared = true;
    clearSE.play();
    document.getElementById("clear").style.display = "block";
  }
}


function isClear() {
  for (let i=0;i<total;i++) {
    if (board[i] !== goal[i]) return false;
  }
  return true;
}

init();
</script>
</body>
</html>
